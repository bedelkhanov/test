# Telegram Mini App with Admin Panel

Этот репозиторий содержит пример простого Telegram‑бота с мини‑приложением и
админской панелью. С помощью этого проекта можно загрузить более 50 единиц
контента, разбитого по рубрикам, и предоставить пользователям удобный
интерфейс для просмотра видео и их анализа внутри Telegram.

## Структура проекта

```
telegram_mini_app/
├── app.py            — Flask‑сервер, обслуживающий мини‑приложение, API и админку
├── bot.py            — Телеграм‑бот на базе aiogram, который отправляет кнопку для открытия мини‑приложения
├── models.py         — определения баз данных SQLAlchemy
├── requirements.txt  — зависимости Python
├── templates/
│   ├── admin.html    — страница админки с формами для добавления рубрик и видео
│   ├── login.html    — форма входа в админку
│   └── mini_app.html — основная страница мини‑приложения для пользователей
└── static/
    ├── mini_app.js   — скрипт, который строит интерфейс мини‑приложения
    └── styles.css    — стили, общие для админки и мини‑приложения
```

## Основные возможности

- **Админ‑панель**: после авторизации администратор может добавлять новые
  категории и загружать видеоролики с описанием/разбором. Файлы сохраняются в
  папке `static/uploads`, а информация о них — в базе данных SQLite.
- **Мини‑приложение**: пользователи, открывая мини‑приложение через кнопку в
  боте, видят список рубрик и роликов. При нажатии на ролик отображается
  встроенный видеоплеер и текстовый анализ.
- **Telegram Web Apps**: мини‑приложение использует Telegram WebApp SDK для
  адаптации к тёмной/светлой теме и взаимодействия с ботом.

## Запуск

1. **Создайте виртуальное окружение и установите зависимости:**

   ```bash
   python -m venv venv
   source venv/bin/activate
   pip install -r requirements.txt
   ```

2. **Создайте бота через [@BotFather](https://t.me/BotFather)** и сохраните
   токен. Настройте домен мини‑приложения с помощью команды `/setdomain` (или
   `/setmenubutton`), указывая публичный URL, на котором будет доступен
   `mini_app.html`.

3. **Настройте переменные окружения:** создайте файл `.env` в корне проекта
   и добавьте

   ```env
   TELEGRAM_BOT_TOKEN=<токен вашего бота>
   ADMIN_USERNAME=admin
   ADMIN_PASSWORD=<пароль для входа в админку>
   WEB_APP_URL=https://example.com   # публичный адрес вашей инсталляции
   SECRET_KEY=<случайная строка>
   ```

   Переменная `WEB_APP_URL` нужна для формирования ссылки на мини‑приложение в
   сообщениях бота. Если вы тестируете локально, можно использовать
   [ngrok](https://ngrok.com/) для создания HTTPS‑туннеля.

4. **Инициализируйте базу данных и запустите сервер:**

   ```bash
   flask --app app.py shell
   >>> from models import db
   >>> db.create_all()
   >>> exit()
   
   # запустить сервер
   python app.py
   ```

5. **Запустите бота:**

   ```bash
   python bot.py
   ```

6. **Войдите в админку:** откройте `https://example.com/admin` и авторизуйтесь.
   Добавляйте категории и загружайте видео. В роликах можно указывать
   описание/разбор, который будет отображаться пользователям.

7. **Проверьте мини‑приложение:** отправьте команду `/start` в боте или
   воспользуйтесь кнопкой «Open Catalog». Пользователь увидит список
   рубрик и роликов. При выборе ролика откроется плеер с анализом.

## Безопасность

- Мини‑приложение использует простой механизм входа через пароль. Для
  серьёзных проектов рекомендуется добавить полноценную систему аутентификации
  (например, OAuth или телеграм‑логин).
- Файлы загружаются в каталог `static/uploads`. Убедитесь, что у сервера
  достаточно прав для записи в этот каталог.

## Лицензия

Этот пример предназначен для демонстрационных целей и может свободно
использоваться и модифицироваться.